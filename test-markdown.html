<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Rendering Test</title>
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.2/marked.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f3f4f6;
        }
        .test-output {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border: 1px solid #e5e7eb;
        }
        h2 { color: #111827; margin-top: 2rem; }
        pre { background: #1f2937; color: #e5e7eb; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
        code { background: #f3f4f6; padding: 0.125rem 0.25rem; border-radius: 0.25rem; color: #dc2626; }
        pre code { background: none; color: #e5e7eb; }
        blockquote { border-left: 4px solid #8b5cf6; padding-left: 1rem; color: #4b5563; font-style: italic; }
    </style>
</head>
<body>
    <h1>Markdown Rendering Test</h1>
    
    <div id="test1" class="test-output"></div>
    <div id="test2" class="test-output"></div>
    <div id="test3" class="test-output"></div>
    
    <script>
        // Test markdown samples
        const testCases = [
            {
                id: 'test1',
                markdown: `# Heading 1
## Heading 2
### Heading 3

This is a **bold** text and this is *italic* text.

Here's a [link to Google](https://google.com).

\`\`\`javascript
function hello() {
    console.log("Hello World!");
}
\`\`\`

- Item 1
- Item 2
  - Nested item
- Item 3`
            },
            {
                id: 'test2',
                markdown: `> This is a blockquote
> with multiple lines

| Header 1 | Header 2 |
|----------|----------|
| Cell 1   | Cell 2   |
| Cell 3   | Cell 4   |

---

1. First item
2. Second item
3. Third item`
            },
            {
                id: 'test3',
                markdown: `## Code Examples

Inline code: \`const x = 42;\`

\`\`\`python
def factorial(n):
    if n <= 1:
        return 1
    return n * factorial(n - 1)
\`\`\`

**Security Test:** <script>alert('XSS')</script>
<img src="x" onerror="alert('XSS')">
\`<script>alert('Should be escaped')</script>\``
            }
        ];

        // Render test cases
        function renderTests() {
            testCases.forEach(test => {
                const element = document.getElementById(test.id);
                try {
                    const rawHtml = marked.parse(test.markdown);
                    const cleanHtml = DOMPurify.sanitize(rawHtml, {
                        ALLOWED_TAGS: [
                            'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
                            'p', 'br', 'hr',
                            'strong', 'b', 'em', 'i', 'del', 's',
                            'code', 'pre',
                            'ul', 'ol', 'li',
                            'blockquote',
                            'a',
                            'table', 'thead', 'tbody', 'tr', 'th', 'td',
                            'img'
                        ],
                        ALLOWED_ATTR: ['href', 'target', 'rel', 'src', 'alt', 'title'],
                        ALLOW_DATA_ATTR: false
                    });
                    element.innerHTML = cleanHtml;
                    console.log(`Test ${test.id} rendered successfully`);
                } catch (error) {
                    element.innerHTML = `<p style="color: red;">Error rendering markdown: ${error.message}</p>`;
                    console.error(`Test ${test.id} failed:`, error);
                }
            });
        }

        // Run tests when dependencies are loaded
        if (typeof marked !== 'undefined' && typeof DOMPurify !== 'undefined') {
            renderTests();
            console.log('All tests completed');
        } else {
            document.body.innerHTML += '<p style="color: red;">Dependencies not loaded!</p>';
        }
    </script>
</body>
</html>